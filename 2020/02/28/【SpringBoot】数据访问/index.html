<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="JDBC配置JDBC获取数据源 前期准备 先到 VirtualBox官网安装虚拟机，导入.OVA文件的centos，安装与VirtualBox版本对应的Oracle VM VirtualBox Extension Pack 。如果别人的centos密码未知，可自行修改密码。 为了方便可以设置好虚拟机网络后，可利用虚拟机的ip地址在客户端SmarTTY与服务器进行交互。 检查好内核版本后，安装Doc">
<meta property="og:type" content="article">
<meta property="og:title" content="【SpringBoot】数据访问">
<meta property="og:url" content="http://yoursite.com/2020/02/28/%E3%80%90SpringBoot%E3%80%91%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/index.html">
<meta property="og:site_name" content="Cymbym">
<meta property="og:description" content="JDBC配置JDBC获取数据源 前期准备 先到 VirtualBox官网安装虚拟机，导入.OVA文件的centos，安装与VirtualBox版本对应的Oracle VM VirtualBox Extension Pack 。如果别人的centos密码未知，可自行修改密码。 为了方便可以设置好虚拟机网络后，可利用虚拟机的ip地址在客户端SmarTTY与服务器进行交互。 检查好内核版本后，安装Doc">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-02-28T03:17:09.000Z">
<meta property="article:modified_time" content="2020-03-02T15:41:10.585Z">
<meta property="article:author" content="Xinbin Shen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/02/28/%E3%80%90SpringBoot%E3%80%91%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>【SpringBoot】数据访问 | Cymbym</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Cymbym</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/28/%E3%80%90SpringBoot%E3%80%91%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xinbin Shen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cymbym">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【SpringBoot】数据访问
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-28 11:17:09" itemprop="dateCreated datePublished" datetime="2020-02-28T11:17:09+08:00">2020-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-02 23:41:10" itemprop="dateModified" datetime="2020-03-02T23:41:10+08:00">2020-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><h2 id="配置JDBC获取数据源"><a href="#配置JDBC获取数据源" class="headerlink" title="配置JDBC获取数据源"></a>配置JDBC获取数据源</h2><ul>
<li><strong>前期准备</strong><ul>
<li>先到 <a href="https://www.virtualbox.org/" target="_blank" rel="noopener">VirtualBox官网</a>安装虚拟机，导入<a href="https://www.jianshu.com/p/e13ee0e3b0a7" target="_blank" rel="noopener">.OVA文件的centos</a>，安装与VirtualBox版本对应的<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener">Oracle VM VirtualBox Extension Pack</a> 。如果别人的centos密码未知，可<a href="https://www.cnblogs.com/jfaith/p/12145494.html" target="_blank" rel="noopener">自行修改密码</a>。</li>
<li>为了方便可以设置好虚拟机网络后，可利用虚拟机的ip地址在客户端SmarTTY与服务器进行交互。</li>
<li>检查好内核版本后，安装Docker。如果遇到linux的内核中的SELinux不支持 overlay2 graph driver，导致Docker启动不了，可<a href="https://www.jianshu.com/p/220ba71aeddb" target="_blank" rel="noopener">在Docker里禁用selinux</a>。 - 安装MySQL镜像，根据镜像启动容器，做端口映射。</li>
<li>下载安装 <a href="https://blog.csdn.net/qq1147093833/article/details/80624667?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">Navicat Premium 12</a> 访问MySQL。</li>
</ul>
</li>
</ul>
<ul>
<li><strong>配置JDBC</strong>  <ul>
<li>基于Spring Initializr创建项目，加入Web、JDBC、MySQL等依赖。     </li>
<li>在MySQL中3306端口的镜像下，新建一个数据库jdbc：    </li>
<li>在配置文件<code>application.yml</code>中写入要连接的数据库：<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.1.100:3306/jdbc?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">initialization-mode:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure></li>
<li>在测试类中写入：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringBoot07DataJdbcApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//class com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        Connection connection = dataSource.getConnection();</span><br><span class="line">        <span class="comment">//HikariProxyConnection@865430810 wrapping com.mysql.cj.jdbc.ConnectionImpl@2e1ddc90</span></span><br><span class="line">        System.out.println(connection);</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
   </li>
<li>可以得到数据源为：<code>class com.zaxxer.hikari.HikariDataSource</code>，数据源的连接池为：<code>HikariProxyConnection@865430810 wrapping com.mysql.cj.jdbc.ConnectionImpl@2e1ddc90</code>。</li>
</ul>
</li>
</ul>
<h2 id="源码：JDBC自动配置原理"><a href="#源码：JDBC自动配置原理" class="headerlink" title="源码：JDBC自动配置原理"></a>源码：JDBC自动配置原理</h2><p>在<code>External libraries</code>找到Spring Boot的自动配置依赖，在<code>org.springframework.boot.autoconfigure</code>下找到<code>jdbc</code>。其中的<code>DataSourceConfiguration</code>，<code>DataSourceInitializerInvoker</code>，<code>JdbcTemplateAutoConfiguration</code>和<code>JdbcTemplateConfiguration</code>需要关注。</p>
<ul>
<li><strong><font color="#FF0000">DataSourceConfiguration</font>：数据源的【自动配置/手动自定义】</strong><br>参考<code>DataSourceConfiguration</code>，根据配置创建数据源，故可以在配置文件<code>application.yml</code>中利用<br><code>spring.datasource.type</code>指定自定义的数据源类型:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(</span><br><span class="line">    proxyBeanMethods = <span class="keyword">false</span></span><br><span class="line">)</span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(&#123;DataSource<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(</span></span><br><span class="line"><span class="class">    <span class="title">name</span> </span>= &#123;<span class="string">"spring.datasource.type"</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span> </span>&#123;</span><br><span class="line">    Generic() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dataSource</span><span class="params">(DataSourceProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
此外，追溯<code>DataSourceProperties</code>类的<code>initializeDataSourceBuilder</code>方法，其返回值为<code>DataSourceBuilder</code>对象。<br>在<code>DataSourceBuilder</code>类中，定义了一个静态常量<code>private static final String[] DATA_SOURCE_TYPE_NAMES = new String[]{&quot;com.zaxxer.hikari.HikariDataSource&quot;, &quot;org.apache.tomcat.jdbc.pool.DataSource&quot;, &quot;org.apache.commons.dbcp2.BasicDataSource&quot;};</code>。<br>由此可知默认是用<code>com.zaxxer.hikari.HikariDataSource</code>作为数据源的。</li>
<li><strong><font color="#FF0000">DataSourceInitializerInvoker</font>：SpringBoot2通过jdbc【创建/初始化】数据表</strong><br><code>DataSourceInitializerInvoker</code><br>是一个实现了<code>ApplicationListener</code>和<code>InitializingBean</code>两个接口的类，多次使用了<code>DataSourceInitializer</code>的对象。<br>在<code>DataSourceInitializer</code>类中，存在<code>createSchema</code>和<code>initSchema</code>方法，分别用于建表和插入数据。二者都用到了<code>getScripts</code>和<code>runScripts</code>方法，且两个方法都传入了配置文件中的参数<code>propertyName：&quot;spring.datasource.schema&quot;</code>，故<font color="#FF0000">可以在配置文件<code>application.yml</code>中声明参数<code>&quot;spring.datasource.schema&quot;</code>【方法一】</font>，随后放在资源文件夹中即可使创建表单/插入数据的资源文件生效。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Resource&gt; <span class="title">getScripts</span><span class="params">(String propertyName, List&lt;String&gt; resources, String fallback)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (resources != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.getResources(propertyName, resources, <span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String platform = <span class="keyword">this</span>.properties.getPlatform();</span><br><span class="line">            List&lt;String&gt; fallbackResources = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            fallbackResources.add(<span class="string">"classpath*:"</span> + fallback + <span class="string">"-"</span> + platform + <span class="string">".sql"</span>);</span><br><span class="line">            fallbackResources.add(<span class="string">"classpath*:"</span> + fallback + <span class="string">".sql"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.getResources(propertyName, fallbackResources, <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">```	  </span><br><span class="line">可见获取`Scripts`的资源文件除了在配置文件中定义，&lt;font color=#FF0000 &gt;还可以将其命名为`"classpath*:" + fallback + "-" + platform + ".sql"`或者`"classpath*:" + fallback + ".sql"`【方法二】&lt;/font&gt;，随后放在资源文件夹中即可使创建表单/插入数据的资源文件生效。  </span><br><span class="line">其中` platform`为字符串`<span class="string">"all"</span>`。`fallback`在在创建Schema时，即在`getSchema()`方法中为`schema`；在初始化Schema（插入数据）时，即`initSchema()`方法中为`data`。  </span><br><span class="line">因此，只需要在类路径下，建立`xxx-all.sql`或者`xxx.sql`，即可在对应的数据库中，找到新建的表。如图，成功建立表：  </span><br><span class="line">&#123;% asset_img pasted-<span class="number">3</span>.png %&#125;  </span><br><span class="line"></span><br><span class="line">## 利用JdbcTemplate操作数据库  </span><br><span class="line">利用`JdbcTemplateAutoConfiguration`和`JdbcTemplateConfiguration`自动配置了JdbcTemplate来操作数据库。</span><br><span class="line">新建一个`HelloController`：</span><br><span class="line">```java</span><br><span class="line">  <span class="meta">@Controller</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Autowired</span></span><br><span class="line">      JdbcTemplate jdbcTemplate;</span><br><span class="line">      <span class="meta">@ResponseBody</span></span><br><span class="line">      <span class="meta">@GetMapping</span>(<span class="string">"/query"</span>)</span><br><span class="line">      <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">map</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          List&lt;Map&lt;String, Object&gt;&gt; list = jdbcTemplate.queryForList(<span class="string">"select * FROM person"</span>);</span><br><span class="line">          <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
此时访问 <a href="http://localhost:8081/query" target="_blank" rel="noopener">http://localhost:8081/query</a> ，可以获取到表<code>person</code>的第一个数据：    

</li>
</ul>
<h1 id="整合Druid数据源"><a href="#整合Druid数据源" class="headerlink" title="整合Druid数据源"></a>整合Druid数据源</h1><h2 id="导入Druid数据源"><a href="#导入Druid数据源" class="headerlink" title="导入Druid数据源"></a>导入Druid数据源</h2><p>从<a href="https://mvnrepository.com/" target="_blank" rel="noopener">Maven Repository</a>，将druid的依赖添加到<code>pom.xml</code>中，并在<code>application.yml</code>中配置druid数据源：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure>
<p>随后可以在测试类中查看是否引入成功:  </p>
   
<p>数据源为<code>class com.alibaba.druid.pool.DruidDataSource</code>，对应的连接池为<code>com.mysql.cj.jdbc.ConnectionImpl@2b2f5fcf</code>。</p>
<h2 id="绑定Druid数据源配置"><a href="#绑定Druid数据源配置" class="headerlink" title="绑定Druid数据源配置"></a>绑定Druid数据源配置</h2><p>在<code>application.yml</code>中写入：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line"><span class="comment">#   数据源基本配置</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.1.100:3306/jdbc?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">initialization-mode:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">#   数据源其他配置（黄色是因为不在数据库中，因此不能绑定到配置里）</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line"><span class="comment">#    filters: stat,wall,slf4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>
<p>此时其他配置在<code>DataSourceProperties.java</code>中并不存在，因此无法绑定，需要在<code>/config</code>文件夹下写一个配置类<code>DruidConfig.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外还需要在<code>pom.xml</code>引入<code>log4j</code>。<br>此时，可以在测试类的连接池中进行debug，查看属性配置是否成功。  </p>
<h2 id="配置Druid的监控"><a href="#配置Druid的监控" class="headerlink" title="配置Druid的监控"></a>配置Druid的监控</h2><p>在<code>DruidConfig.java</code>中配置一个管理后台的Servlet和一个web监控的filter，并将二者注册到容器bean中，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置Druid的监控</span></span><br><span class="line"><span class="comment">//1、配置一个管理后台的Servlet，访问地址localhost:8081/druid</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">	  <span class="comment">//把StatViewServlet()注册到bean，并处理"/druid/*"的所有请求</span></span><br><span class="line">    ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(), <span class="string">"/druid/*"</span>);</span><br><span class="line">    Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    initParams.put(<span class="string">"loginUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">    initParams.put(<span class="string">"loginPassword"</span>,<span class="string">"123"</span>);</span><br><span class="line">    initParams.put(<span class="string">"allow"</span>,<span class="string">""</span>);<span class="comment">//默认就是允许所有访问</span></span><br><span class="line">    initParams.put(<span class="string">"deny"</span>,<span class="string">"192.168.10.100"</span>);</span><br><span class="line">    bean.setInitParameters(initParams);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2、配置一个web监控的filter，任何请求都需要通过filter实现监控，除了静态资源*.js,*.css，登录请求/druid/*</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FilterRegistrationBean bean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">    <span class="comment">// 注册WebStatFilter()实例	</span></span><br><span class="line">    bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">    Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// 设置初始化参数，拦截除了"*.js,*.css,/druid/*"的所有请求</span></span><br><span class="line">    initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.css,/druid/*"</span>);</span><br><span class="line">    bean.setInitParameters(initParams);</span><br><span class="line">    bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));<span class="comment">// 拦截所有请求：</span></span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时运行主程序，访问 <a href="http://localhost:8081/druid" target="_blank" rel="noopener">http://localhost:8081/druid</a> 并用<code>ServletRegistrationBean</code>的初始化参数来登录：  </p>
   
<p>随后，浏览器访问 <a href="http://localhost:8081/query" target="_blank" rel="noopener">http://localhost:8081/query</a> 进行操作数据库的请求，在<code>Web应用</code>选项下，成功用filter监控了此次请求：  </p>
   
<p><code>SQL监控</code>也成功记录了此次SQL的操作记录：  </p>


<h1 id="整合MyBatis"><a href="#整合MyBatis" class="headerlink" title="整合MyBatis"></a>整合MyBatis</h1><h2 id="配置MyBatis"><a href="#配置MyBatis" class="headerlink" title="配置MyBatis"></a>配置MyBatis</h2><p>基于Spring Initializr创建项目，加入Web、JDBC、MySQL、MyBatis等依赖。   </p>
  
<p>可以看出MyBatis的依赖不是spring boot官方出的，而是自己适配spring boot出的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对上述依赖右键选择<code>Diagrams</code>，可以看出mybatis的启动器引入了mybatis包、mybatis自动配置包、mybatis中间的整合包。  </p>

<h2 id="引入druid数据源，并绑定配置"><a href="#引入druid数据源，并绑定配置" class="headerlink" title="引入druid数据源，并绑定配置"></a>引入druid数据源，并绑定配置</h2><p>新建一个数据库，名为mybatis：  </p>
  
<p>在<code>application.yml</code>中写入：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#   数据源基本配置</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.1.100:3306/mybatis?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">initialization-mode:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="comment">#   数据源其他配置</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>
<p>在<code>/config</code>文件夹下写一个配置类<code>DruidConfig.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//配置Druid的监控</span></span><br><span class="line">    <span class="comment">//1、配置一个管理后台的Servlet，访问地址localhost:8081/druid</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//把StatViewServlet()注册到bean，并处理"/druid/*"的所有请求</span></span><br><span class="line">        ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(), <span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"loginUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"loginPassword"</span>,<span class="string">"123"</span>);</span><br><span class="line">        initParams.put(<span class="string">"allow"</span>,<span class="string">""</span>);<span class="comment">//默认就是允许所有访问</span></span><br><span class="line">        initParams.put(<span class="string">"deny"</span>,<span class="string">"192.168.10.100"</span>);</span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2、配置一个web监控的filter，任何请求都需要通过filter实现监控，除了静态资源*.js,*.css，登录请求/druid/*</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FilterRegistrationBean bean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">        <span class="comment">// 注册WebStatFilter()实例</span></span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">        Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// 设置初始化参数，拦截除了"*.js,*.css,/druid/*"的所有请求</span></span><br><span class="line">        initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.css,/druid/*"</span>);</span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));<span class="comment">// 拦截所有请求：</span></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>pom.xml</code>引入<code>log4j</code>。<br>随后访问 <a href="http://localhost:8082/druid" target="_blank" rel="noopener">http://localhost:8082/druid</a> ，成功来到控制台页面。</p>
<h2 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h2><p>在<code>/resources</code>文件夹下新建<code>sql</code>文件夹，将<code>department.sql</code>和<code>employee.sql</code>放入，并在<code>application.yml</code>中写入：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">classpath:sql/department.sql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">classpath:sql/employee.sql</span></span><br></pre></td></tr></table></figure>
<p>此时刷新下IDEA，启动后即可新建两个数据表。</p>
<h2 id="创建JavaBean"><a href="#创建JavaBean" class="headerlink" title="创建JavaBean"></a>创建JavaBean</h2><p>在项目文件夹下新建<code>bean</code>文件夹，新建<code>Department.java</code>类和<code>Employee.java</code>类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String departmentName;</span><br></pre></td></tr></table></figure>
<p>在<code>Employee.java</code>类中加入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String lastName;</span><br><span class="line"><span class="keyword">private</span> Integer gender;</span><br><span class="line"><span class="keyword">private</span> String email;</span><br><span class="line"><span class="keyword">private</span> Integer dId;</span><br></pre></td></tr></table></figure>
<p>二者都使用<code>Alt</code>+<code>Insert</code>插入<code>setter</code>和<code>getter</code>方法。</p>
<h2 id="注解版Mybatis：执行MySQL的增删改查"><a href="#注解版Mybatis：执行MySQL的增删改查" class="headerlink" title="注解版Mybatis：执行MySQL的增删改查"></a>注解版Mybatis：执行MySQL的增删改查</h2><ul>
<li><p><strong>创建@Mapper注解的mapper接口：直接操作数据库</strong><br>在项目文件夹下新建<code>mapper</code>文件夹，新建<code>DepartmentMapper.java</code>类。<br>在<code>DepartmentMapper.java</code>类中加入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定这是一个操作数据库的mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="comment">//获取自动id：使用自动生成组件+告诉Mybatis："id"属性是用来封装组件的</span></span><br><span class="line">    <span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>, keyProperty = <span class="string">"id"</span>)</span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into department(departmentName) values(#&#123;departmentName&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>写一个controller测试</strong><br>在<code>/controller</code>文件夹下写一个<code>DeptController.java</code>，测试能否实现department的查和增：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DepartmentMapper departmentMapper;</span><br><span class="line"> <span class="comment">//以请求参数的方式返回id，随后用id执行需要的查询操作</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/dept/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDepartment</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> departmentMapper.getDeptById(id);</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">//将所有请求参数封装成Department对象，随后用该对象执行需要的插入操作</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/dept"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">insertDepartment</span><span class="params">(Department department)</span> </span>&#123;</span><br><span class="line">        departmentMapper.insertDept(department);</span><br><span class="line">        <span class="keyword">return</span> department;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://localhost:8082/dept/1" target="_blank" rel="noopener">http://localhost:8082/dept/1</a> 。此时，查询未果，返回为空白页面：  </p>
   
<p>访问 <a href="http://localhost:8082/dept?departmentName=AA" target="_blank" rel="noopener">http://localhost:8082/dept?departmentName=AA</a> 。此时插入了一个department：  </p>
  
<p>查看数据库。插入成功：  </p>
 
<p>访问 <a href="http://localhost:8082/dept/2" target="_blank" rel="noopener">http://localhost:8082/dept/2</a> 。此时查询到了这个department：   </p>
 
</li>
<li><p><strong>两种开启驼峰命名法的配置</strong><br>当JavaBean中的名字（departmentName）和数据库中的名字（department_name）不一样时，便无法完成操作数据库的命令。此时需要修改配置，开启驼峰命名法。  </p>
<ul>
<li>配置文件直接配置<br>在<code>application.yml</code>中写入：<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">	  <span class="attr">configuration:</span></span><br><span class="line">    	<span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
<li>利用源码中的ConfigurationCustomizer进行自定义配置<br>不用配置文件的情况下开启驼峰命名法，在<code>/config</code>文件夹下写一个配置类<code>MyBatisConfig.java</code>：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigurationCustomizer <span class="title">configurationCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConfigurationCustomizer()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Configuration configuration)</span> </span>&#123;</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>使用@MapperScan批量扫描所有的Mapper接口</strong><br>若不想在每个mapper类上都标注<code>@Mapper</code>注解，只需要在主程序中用<code>@MapperScan</code>注解，便可以指定某个包下的所有接口都添加<code>@Mapper</code>注解，实现批量扫描所有的Mapper接口：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(value = <span class="string">"com.example.springboot.mapper"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot08DataMybatisApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot08DataMybatisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="配置文件版Mybatis：执行MySQL的增删改查"><a href="#配置文件版Mybatis：执行MySQL的增删改查" class="headerlink" title="配置文件版Mybatis：执行MySQL的增删改查"></a>配置文件版Mybatis：执行MySQL的增删改查</h2><ul>
<li><strong>创建无@mapper注解的mapper接口：简化mapper</strong><br>在<code>mapper</code>文件夹，新建<code>EmployeeMapper.java</code>类。<br>在<code>EmployeeMapper.java</code>类中加入：  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertEmp</span><span class="params">(Employee employee)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>mybatis全局配置文件：自定义mybatis的配置</strong><br>在<code>/resources</code>文件夹下，新建<code>/mybatis</code>文件夹，文件夹下新建全局配置文件<code>mybatis_config.xml</code>，写入的内容来源于 <a href="https://mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">mybatis官方文档</a> 中的<code>Building SqlSessionFactory from XML</code>：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!--此处替换成自己所需的配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
其中，驼峰命名法的<code>name</code>参见官网 <a href="https://mybatis.org/mybatis-3/configuration.html" target="_blank" rel="noopener">mybatis官方文档</a>。</li>
<li><strong>sql映射文件：在配置文件操作数据库</strong><br>在<code>/resources/mybatis</code>文件夹下，新建<code>/mapper</code>文件夹，文件夹下新建sql映射文件<code>EmployeeMapper.xml</code>，写入的内容来源于 <a href="https://mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">mybatis官方文档</a> 中的<code>Exploring Mapped SQL Statements</code>：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line">        <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">"com.example.springboot.mapper.EmployeeMapper"</span>&gt;</span><br><span class="line">    &lt;!--    <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(Integer id)</span></span>;--&gt;</span><br><span class="line">    &lt;select id=<span class="string">"getEmpById"</span> resultType=<span class="string">"com.example.springboot.bean.Employee"</span>&gt;</span><br><span class="line">        SELECT * FROM employee WHERE id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;!--    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertEmp</span><span class="params">(Employee employee)</span></span>;--&gt;</span><br><span class="line">    &lt;insert id=<span class="string">"insertEmp"</span>&gt;</span><br><span class="line">        <span class="function">INSERT INTO <span class="title">employee</span><span class="params">(lastName,email,gender,d_id)</span> <span class="title">VALUES</span> <span class="params">(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;,#&#123;dId&#125;)</span></span></span><br><span class="line"><span class="function">    &lt;/insert&gt;</span></span><br><span class="line"><span class="function">&lt;/mapper&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><strong>springboot配置文件：指定mybatis所有配置文件位置</strong><br>在<code>application.yml</code>中指定全局配置文件和sql映射文件的位置，由于此处指定了mybatis全局配置的位置，不能再指定mybatis的其他配置，故将之前的驼峰命名法的配置挪到<code>mybatis_config.xml</code>中。<code>application.yml</code>中写入：<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">mybatis:</span></span><br><span class="line">      <span class="string">config‐location:</span> <span class="string">classpath:mybatis/mybatis_config.xml</span>  <span class="comment"># 指定全局配置文件的位置</span></span><br><span class="line">      <span class="string">mapper‐locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>       <span class="comment"># 指定sql映射文件的位置</span></span><br><span class="line"><span class="string">```</span>  </span><br><span class="line"><span class="string">*</span> <span class="string">**写一个controller测试**</span>   </span><br><span class="line"><span class="string">在`/controller/DeptController.java`中，测试能否实现employee的查：</span></span><br><span class="line"><span class="string">```java</span></span><br><span class="line">    <span class="string">@Autowired</span></span><br><span class="line">    <span class="string">EmployeeMapper</span> <span class="string">employeeMapper;</span></span><br><span class="line">    <span class="string">@GetMapping("/emp/&#123;id&#125;")</span></span><br><span class="line">    <span class="string">public</span> <span class="string">Employee</span> <span class="string">getEmp(@PathVariable("id")</span> <span class="string">Integer</span> <span class="string">id)</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">return</span> <span class="string">employeeMapper.getEmpById(id);</span></span><br><span class="line">    <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
新增Employee表数据：    
访问 <a href="http://localhost:8082/emp/1" target="_blank" rel="noopener">http://localhost:8082/emp/1</a> 。此时，查询到了这个employee：     

</li>
</ul>
<h1 id="整合SpringData-JPA"><a href="#整合SpringData-JPA" class="headerlink" title="整合SpringData JPA"></a>整合SpringData JPA</h1><h1 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h1><p><a href="https://mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">mybatis官方文档</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/02/09/%E3%80%90SpringBoot%E3%80%91Web%E5%BC%80%E5%8F%91/" rel="prev" title="【SpringBoot】Web开发">
      <i class="fa fa-chevron-left"></i> 【SpringBoot】Web开发
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#JDBC"><span class="nav-number">1.</span> <span class="nav-text">JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置JDBC获取数据源"><span class="nav-number">1.1.</span> <span class="nav-text">配置JDBC获取数据源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#源码：JDBC自动配置原理"><span class="nav-number">1.2.</span> <span class="nav-text">源码：JDBC自动配置原理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#整合Druid数据源"><span class="nav-number">2.</span> <span class="nav-text">整合Druid数据源</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#导入Druid数据源"><span class="nav-number">2.1.</span> <span class="nav-text">导入Druid数据源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#绑定Druid数据源配置"><span class="nav-number">2.2.</span> <span class="nav-text">绑定Druid数据源配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Druid的监控"><span class="nav-number">2.3.</span> <span class="nav-text">配置Druid的监控</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#整合MyBatis"><span class="nav-number">3.</span> <span class="nav-text">整合MyBatis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置MyBatis"><span class="nav-number">3.1.</span> <span class="nav-text">配置MyBatis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#引入druid数据源，并绑定配置"><span class="nav-number">3.2.</span> <span class="nav-text">引入druid数据源，并绑定配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建数据表"><span class="nav-number">3.3.</span> <span class="nav-text">创建数据表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建JavaBean"><span class="nav-number">3.4.</span> <span class="nav-text">创建JavaBean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注解版Mybatis：执行MySQL的增删改查"><span class="nav-number">3.5.</span> <span class="nav-text">注解版Mybatis：执行MySQL的增删改查</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件版Mybatis：执行MySQL的增删改查"><span class="nav-number">3.6.</span> <span class="nav-text">配置文件版Mybatis：执行MySQL的增删改查</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#整合SpringData-JPA"><span class="nav-number">4.</span> <span class="nav-text">整合SpringData JPA</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#推荐"><span class="nav-number">5.</span> <span class="nav-text">推荐</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xinbin Shen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xinbin Shen</span>
</div>


<div align="center"><div style=" width:300px; border:1px solid #000; ">  <script type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?d=9To9_PvbL2L91dodzGWnd2ywH3kwM4OuZ81rHrm-K-c&cl=ffffff&w=a"></script>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
